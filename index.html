<html>
    <head>
        <script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.5.2/jstat.min.js"></script>
        <!--script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script-->
        <script type="text/javascript" charset="utf-8" src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>
    </head>

    <body>
        <div id="chartContainer" width="400" height="400"></div>
        <script>
            "use strict";

            //column 11 is 'Adjusted Close'
            var ticker = 'AAPL';
            //sign up to quandl and retrieve you key
            var key = '';
            var url = 'https://www.quandl.com/api/v1/datasets/WIKI/'+ticker+'.json?column=11&transformation=rdiff'+key;

            var trendChart = new CanvasJS.Chart("chartContainer", {
                    title: {  text : "Closing Stock Price" },
                    data: [
                        {
                            type: "spline",
                            dataPoints: []
                        }
                    ]
                    }
                    )

            function getData(url){
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET", url, true);
                xmlhttp.setRequestHeader("Content-Type", "application/json");

                xmlhttp.onload = function() {
                    var result = JSON.parse(this.responseText);

                    result.data.buildTrendPlot(trendChart);
                    trendChart.render();

                    xmlhttp.abort();
                }

                xmlhttp.send();
            }

            getData(url);

            Array.prototype.buildTrendPlot = function(chart) {
                this.forEach(
                    function(i) {
                        chart.options.data[0].dataPoints.push( { x: new Date(i[0]), y:i[1] } );
                    }
                );
            }

            Array.prototype.doAnalysis = function() {
                console.log( jStat.meddev(this) );
            }


    </script>

    </body>
</html>
