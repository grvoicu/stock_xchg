<html>
    <head>
        <script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.5.2/jstat.min.js"></script>
        <!--script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script-->
        <script type="text/javascript" charset="utf-8" src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>
    </head>

    <body>
        <select id="companySelector" onchange="getData()">
            <option value="FB">Facebook</option>
            <option value="AAPL">aapl</option>
        </select></br>
        <div id="chartContainer" width="400" height="400"></div>
        <script>
            "use strict";

            //sign up to quandl and retrieve you key
            var key = '&api_key=_6y5mT58Zp8ubah543oS';
            var url = 'https://www.quandl.com/api/v3/datasets/WIKI/'


            var trendChart = new CanvasJS.Chart("chartContainer", {
                    title: {  text : "Closing Stock Price" },
                    data: [
                        {
                            type: "spline",
                            dataPoints: []
                        }
                    ]
                    }
                    )

            function getData() {
                var column = 4;  // column 4 is 'Close'
                var comp_elem = document.getElementById("companySelector");
                var company = comp_elem.options[comp_elem.selectedIndex].value;
                var company_url = url+company+'/data.json?column_index='+column+key;
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET", company_url, true);
                xmlhttp.setRequestHeader("Content-Type", "application/json");

                xmlhttp.onload = function() {
                    var result = JSON.parse(this.responseText);

                    result.dataset_data.data.buildTrendPlot(trendChart);
                    trendChart.render();

                    xmlhttp.abort();
                }

                xmlhttp.send();
            }

            getData();

            Array.prototype.buildTrendPlot = function(chart) {
                chart.options.data[0].dataPoints = [];
                this.forEach(
                    function(i) {
                        chart.options.data[0].dataPoints.push( { x: new Date(i[0]), y:i[1] } );
                    }
                );
            }

            Array.prototype.doAnalysis = function() {
                console.log( jStat.meddev(this) );
            }


    </script>

    </body>
</html>
